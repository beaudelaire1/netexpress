{% extends "base.html" %}

{% block title %}Tableau de bord — NetExpress{% endblock %}

{% block content %}
<section class="section">
  <div class="section__head">
    <h1>Tableau de bord</h1>
    <p class="muted">Vue d’ensemble des tâches, factures et devis.</p>
  </div>
  <div class="grid" style="grid-template-columns: repeat(auto-fit, minmax(300px,1fr)); gap:24px;">
    <!-- Tâches -->
    <div>
      <h2>Tâches</h2>
      {% if tasks %}
      <ul class="list">
        {% for t in tasks %}
        <li>
          <strong>{{ t.title }}</strong><br>
          <small>{{ t.get_status_display }} — échéance le {{ t.due_date|date:'d/m/Y' }}</small>
        </li>
        {% endfor %}
      </ul>
      <p><a href="{% url 'tasks:list' %}">Voir toutes les tâches →</a></p>
      {% else %}
      <p>Aucune tâche enregistrée.</p>
      {% endif %}
    </div>
    <!-- Factures récentes -->
    <div>
      <h2>Factures récentes</h2>
      {% if invoices %}
      <ul class="list">
        {% for inv in invoices %}
        <li>
          <strong>{{ inv.number }}</strong> — {{ inv.total_ttc }} € TTC<br>
          <small>Émise le {{ inv.issue_date|date:'d/m/Y' }}{% if inv.due_date %}, échéance le {{ inv.due_date|date:'d/m/Y' }}{% endif %}</small>
          {% if inv.pdf %}
          <br><a href="{{ inv.pdf.url }}" target="_blank">Voir le PDF</a>
          {% endif %}
        </li>
        {% endfor %}
      </ul>
      <p><a href="{% url 'admin:index' %}?app_label=factures&model_name=invoice">Voir toutes les factures →</a></p>
      {% else %}
      <p>Aucune facture disponible.</p>
      {% endif %}
    </div>
    <!-- Devis récents -->
    <div>
      <h2>Devis récents</h2>
      {% if quotes %}
      <ul class="list">
        {% for q in quotes %}
        <li>
          {# Afficher le numéro de devis comme lien vers le PDF si celui‑ci existe.  #}
          {% if q.pdf %}
          <strong><a href="{% url 'devis:download' q.pk %}" target="_blank">{{ q.number }}</a></strong>
          {% else %}
          <strong>{{ q.number }}</strong>
          {% endif %}
          — {{ q.total_ttc }} € TTC<br>
          <small>Émis le {{ q.issue_date|date:'d/m/Y' }}</small>
        </li>
        {% endfor %}
      </ul>
      <p><a href="{% url 'admin:index' %}?app_label=devis&model_name=quote">Voir tous les devis →</a></p>
      {% else %}
      <p>Aucun devis disponible.</p>
      {% endif %}
    </div>

    <!-- Messages récents -->
    <div>
      <h2>Messages récents</h2>
      {% if recent_messages %}
      <ul class="list">
        {% for m in recent_messages %}
        <li>
          <strong>{{ m.subject }}</strong><br>
          <small>{{ m.recipient }} — {{ m.created_at|date:'d/m/Y' }}</small>
        </li>
        {% endfor %}
      </ul>
      <p><a href="{% url 'messaging:list' %}">Voir tous les messages →</a></p>
      {% else %}
      <p>Aucun message envoyé récemment.</p>
      {% endif %}
    </div>
  </div>
</section>
{% endblock %}
