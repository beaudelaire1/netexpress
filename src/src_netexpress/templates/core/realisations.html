{% extends "base.html" %}
{% load static %}

{#
  Page de galerie pour présenter les réalisations.  Un filtre permet
  d'afficher rapidement les catégories Nettoyage, Espaces verts ou
  Rénovation.  Un simple lightbox maison s'affiche au clic afin de
  voir l'image en grand avec son titre.  Toutes les interactions
  reposent sur du JavaScript minimal inclus en bas de page.
#}

{% block extra_head %}
  <!-- Chargement des icônes FontAwesome pour les éventuelles décorations -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
{% endblock %}

{% block title %}Réalisations — NetExpress{% endblock %}

{% block content %}
<section class="section">
  <div class="container" style="text-align:center; margin-bottom:2rem;">
    <h1>Nos Réalisations</h1>
    <p class="muted">Découvrez quelques exemples de projets menés avec soin en Guyane.</p>
    <!-- Boutons de filtre -->
    <div style="margin-top:1rem; display:flex; justify-content:center; gap:0.5rem; flex-wrap:wrap;">
      {% for slug, name in categories %}
        <button type="button" class="btn filter-btn{% if forloop.first %} active{% endif %}" data-category="{{ slug }}">{{ name }}</button>
      {% endfor %}
    </div>
  </div>
  <!-- Grille de la galerie -->
  <div class="container" id="gallery" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap:1rem;">
    {% for image in images %}
    <div class="gallery-item" data-category="{{ image.category }}" style="cursor:pointer; position:relative; overflow:hidden; border-radius:var(--radius); box-shadow:var(--shadow-1);">
      <img src="{{ image.url }}" alt="{{ image.title }}" style="width:100%; height:200px; object-fit:cover; display:block;">
      <div style="position:absolute; inset:0; background:linear-gradient(180deg,rgba(0,0,0,0) 0%, rgba(0,0,0,0.6) 100%); display:flex; flex-direction:column; justify-content:flex-end; padding:0.5rem;">
        <span style="font-size:0.8rem; color:#e0f2f1; text-transform:uppercase; letter-spacing:1px;">
          {% if image.category == 'nettoyage' %}Nettoyage{% elif image.category == 'espaces_verts' %}Espaces verts{% elif image.category == 'renovation' %}Rénovation{% else %}{{ image.category }}{% endif %}
        </span>
        <h3 class="title" style="margin:0; color:#fff; font-size:1.1rem;">{{ image.title }}</h3>
      </div>
    </div>
    {% endfor %}
  </div>
</section>

<!-- Lightbox overlay -->
<div id="lightbox" class="lightbox-overlay">
  <div style="text-align:center;">
    <img src="" alt="">
    <div class="caption"></div>
  </div>
</div>

    <!-- Script de filtrage et de lightbox pour la galerie -->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const buttons = document.querySelectorAll('.filter-btn');
        const items = document.querySelectorAll('.gallery-item');
        const lightbox = document.getElementById('lightbox');
        const lightboxImg = lightbox.querySelector('img');
        const caption = lightbox.querySelector('.caption');

        buttons.forEach((btn) => {
          btn.addEventListener('click', function () {
            // Met à jour l'état actif
            buttons.forEach((b) => b.classList.remove('active'));
            this.classList.add('active');
            const cat = this.getAttribute('data-category');
            items.forEach((item) => {
              const itemCat = item.getAttribute('data-category');
              if (cat === 'all' || itemCat === cat) {
                item.style.display = '';
              } else {
                item.style.display = 'none';
              }
            });
          });
        });

        // Gestion de la lightbox
        items.forEach((item) => {
          item.addEventListener('click', function () {
            const img = this.querySelector('img');
            const title = this.querySelector('.title').textContent;
            lightboxImg.src = img.src;
            caption.textContent = title;
            lightbox.style.display = 'flex';
          });
        });
        // Fermer la lightbox en cliquant en dehors de l'image
        lightbox.addEventListener('click', function (e) {
          if (e.target === lightbox) {
            lightbox.style.display = 'none';
          }
        });
      });
    </script>

{% endblock %}