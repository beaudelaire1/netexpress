{% load static %}
<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Devis {{ quote.number }}</title>
</head>
<body>
  <div class="doc">
    <div class="header">
      <div>
        {% if branding.logo_path %}
          <img class="logo" src="{{ branding.logo_path }}" alt="Logo">
        {% else %}
          <div class="kicker">{{ branding.name|default:"NetExpress" }}</div>
        {% endif %}
        <div class="kicker">Devis</div>
        <h1 class="title">{{ quote.number }}</h1>
        <div class="small">Émis le {{ quote.issue_date|date:"d/m/Y" }}{% if quote.valid_until %} — Valable jusqu'au {{ quote.valid_until|date:"d/m/Y" }}{% endif %}</div>
      </div>

      <div style="text-align:right">
        <div class="badge">{{ branding.tagline|default:"Nettoyage de prestige" }}</div>
        <div style="height:6mm"></div>
        <div><strong>{{ branding.name|default:"NetExpress" }}</strong></div>
        {% if branding.address_lines %}
          <div class="small">
            {% for l in branding.address_lines %}{{ l }}<br>{% endfor %}
          </div>
        {% else %}
          <div class="small">{{ branding.address|linebreaksbr }}</div>
        {% endif %}
        <div class="small">
          {% if branding.phone %}{{ branding.phone }}<br>{% endif %}
          {% if branding.email %}{{ branding.email }}{% endif %}
        </div>
      </div>
    </div>

    <div class="hr"></div>

    <div class="grid2">
      <div class="panel">
        <h3>Client</h3>
        <div><strong>{{ quote.client.full_name }}</strong></div>
        <div class="small">
          {% if quote.client.email %}{{ quote.client.email }}<br>{% endif %}
          {% if quote.client.phone %}{{ quote.client.phone }}<br>{% endif %}
          {% if quote.client.city %}{{ quote.client.city }}{% endif %}
        </div>
      </div>

      <div class="panel">
        <h3>Référence</h3>
        <div class="small">
          Statut : {{ quote.get_status_display }}<br>
          Créé le : {{ quote.created_at|date:"d/m/Y H:i" }}
        </div>
      </div>
    </div>

    <table class="table" role="presentation">
      <thead>
        <tr>
          <th>Prestation</th>
          <th class="right">Qté</th>
          <th class="right">PU HT</th>
          <th class="right">TVA</th>
          <th class="right">Montant TTC</th>
        </tr>
      </thead>
      <tbody>
      {% for item in quote.quote_items.all %}
        <tr>
          <td>
            <div><strong>{{ item.title|default:item.description }}</strong></div>
            {% if item.description and item.title %}<div class="small">{{ item.description }}</div>{% endif %}
          </td>
          <td class="right">{{ item.quantity }}</td>
          <td class="right">{{ item.unit_price|floatformat:2 }} €</td>
          <td class="right">{{ item.tax_rate|floatformat:2 }} %</td>
          <td class="right">{{ item.total_ttc|floatformat:2 }} €</td>
        </tr>
      {% empty %}
        <tr><td colspan="5" class="small muted">Aucune prestation.</td></tr>
      {% endfor %}
      </tbody>
    </table>

    <div class="totals">
      <div class="totals-box">
        <div class="totals-row"><span class="muted">Total HT</span><span>{{ quote.total_ht|floatformat:2 }} €</span></div>
        <div class="totals-row"><span class="muted">TVA</span><span>{{ quote.tva|floatformat:2 }} €</span></div>
        <div class="totals-row total"><strong>Total TTC</strong><strong>{{ quote.total_ttc|floatformat:2 }} €</strong></div>
      </div>
    </div>

    <div class="payment">
      <div style="display:flex; justify-content:space-between; gap:10mm">
        <div>
          <h3>Conditions de paiement</h3>
          <div class="small">
            {{ branding.payment_terms|default:"Paiement : 30 jours après démarrage des travaux." }}
          </div>
        </div>
        <div style="text-align:right">
          <h3>Coordonnées bancaires</h3>
          <div class="small">
            {% if branding.iban %}<strong>IBAN</strong> : {{ branding.iban }}<br>{% endif %}
            {% if branding.bic %}<strong>BIC</strong> : {{ branding.bic }}{% endif %}
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <div>
        <div><strong>Mentions</strong></div>
        <div>Devis non contractuel jusqu'à acceptation.</div>
      </div>
      <div style="text-align:right">
        <div><strong>{{ branding.name|default:"NetExpress" }}</strong></div>
        <div>{{ branding.email|default:"" }}</div>
      </div>
    </div>
  </div>
</body>
</html>
