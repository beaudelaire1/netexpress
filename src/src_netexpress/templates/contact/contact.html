{% extends "base.html" %}
{% load static %}

{% block title %}Contact — Nettoyage Express à Cayenne, Matoury, Remire-Montjoly{% endblock %}

{% block meta_description %}Contactez Nettoyage Express pour vos besoins en nettoyage, entretien d'espaces verts et rénovation. Intervention rapide à Cayenne, Matoury, Remire-Montjoly et Macouria. Devis gratuit.{% endblock %}

{% block og_title %}Contactez Nettoyage Express — Services en Guyane{% endblock %}
{% block og_desc %}Demandez un devis gratuit ou contactez-nous pour vos projets de nettoyage et d'entretien à Cayenne et dans toute la Guyane.{% endblock %}

{% block content %}
<section class="section contact-section">
  <div class="contact-card animated-border">
    <div class="contact-head">
      <h1>Nous contacter</h1>
      <p class="muted">Choisissez le sujet qui correspond à votre demande et laissez‑nous un message. Nous vous répondrons rapidement.</p>
    </div>

    <form method="post" novalidate class="contact-form">
      {% csrf_token %}
      {{ form.non_field_errors }}

      <div class="contact-grid">
        <div class="field">
          {{ form.topic.errors }}
          <label for="{{ form.topic.id_for_label }}">Sujet</label>
          {{ form.topic }}
        </div>

        <div class="field">
          {{ form.full_name.errors }}
          <label for="{{ form.full_name.id_for_label }}">Nom Complet</label>
          {{ form.full_name }}
        </div>

        <div class="field">
          {{ form.email.errors }}
          <label for="{{ form.email.id_for_label }}">Email</label>
          {{ form.email }}
        </div>

        <div class="field">
          {{ form.phone.errors }}
          <label for="{{ form.phone.id_for_label }}">Téléphone</label>
          {{ form.phone }}
        </div>

        <div class="field">
          {{ form.street.errors }}
          <label for="{{ form.phone.id_for_label }}">Rue</label>
          {{ form.street }}
        </div>

        <div class="field">
          {{ form.city.errors }}
          <label for="{{ form.city.id_for_label }}">Commune</label>
          {{ form.city }}
          <datalist id="city-list"></datalist>
        </div>

        <div class="field">
          {{ form.zip_code.errors }}
          <label for="{{ form.zip_code.id_for_label }}">Code Postal</label>
          {{ form.zip_code }}
          <datalist id="zip-list"></datalist>
        </div>

        <div class="field field-full">
          {{ form.body.errors }}
          <label for="{{ form.body.id_for_label }}">Message</label>
          {{ form.body }}
        </div>
      </div>

      <div class="contact-actions">
        <button class="btn" type="submit">Envoyer</button>
        <small class="muted">Nous vous contacterons au plus vite.</small>
      </div>
    </form>
  </div>
</section>

{{ communes|json_script:"guyane-communes" }}

<script>
(function(){
  const dataEl = document.getElementById("guyane-communes");
  if(!dataEl) return;
  const communes = JSON.parse(dataEl.textContent || "{}");

  const cityInput = document.getElementById("id_city");
  const zipInput  = document.getElementById("id_zip_code");
  const cityList = document.getElementById("city-list");
  const zipList  = document.getElementById("zip-list");

  // hydrate datalists
  if(cityList){
    Object.keys(communes).forEach((name)=>{
      const opt=document.createElement("option");
      opt.value=name;
      cityList.appendChild(opt);
    });
    if(cityInput) cityInput.setAttribute("list","city-list");
  }
  if(zipList){
    Array.from(new Set(Object.values(communes))).sort().forEach((zip)=>{
      const opt=document.createElement("option");
      opt.value=zip;
      zipList.appendChild(opt);
    });
    if(zipInput) zipInput.setAttribute("list","zip-list");
  }

  function cityToZip(){
    if(!cityInput || !zipInput) return;
    const v = (cityInput.value || "").trim();
    if(communes[v]) zipInput.value = communes[v];
  }
  function zipToCity(){
    if(!cityInput || !zipInput) return;
    const z = (zipInput.value || "").trim();
    const found = Object.keys(communes).find((k)=>communes[k] === z);
    if(found) cityInput.value = found;
  }

  if(cityInput){
    cityInput.addEventListener("change", cityToZip);
    cityInput.addEventListener("blur", cityToZip);
  }
  if(zipInput){
    zipInput.addEventListener("change", zipToCity);
    zipInput.addEventListener("blur", zipToCity);
  }
})();
</script>
{% endblock %}
