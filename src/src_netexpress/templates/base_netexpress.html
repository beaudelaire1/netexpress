{% load static %}
<!DOCTYPE html>
<html lang="fr" class="h-full">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <!-- SEO Meta Tags -->
  <meta property="og:site_name" content="NetExpress">
  <meta property="og:type" content="website">
  <meta property="og:url" content="{{ request.build_absolute_uri }}">
  <meta property="og:title" content="{% block og_title %}NetExpress{% endblock %}">
  <meta property="og:description" content="{% block og_desc %}NetExpress — Votre ERP de services en Guyane.{% endblock %}">
  <meta name="description" content="{% block meta_description %}NetExpress — Gestion de services de nettoyage, entretien et espaces verts en Guyane.{% endblock %}">
  
  <title>{% block title %}NetExpress{% endblock %}</title>
  <link rel="canonical" href="{{ request.build_absolute_uri }}">
  
  <!-- Fonts — Plus Jakarta Sans (moderne) + Inter (lisibilité) -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Icons — Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

  <!-- TailwindCSS CDN avec config NetExpress Bleue -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            // Palette Bleue NetExpress
            'ne-blue': {
              50:  '#eff6ff',
              100: '#dbeafe',
              200: '#bfdbfe',
              300: '#93c5fd',
              400: '#60a5fa',
              500: '#3b82f6',
              600: '#2563eb',
              700: '#1d4ed8',
              800: '#1e40af',
              900: '#1e3a8a',
              950: '#172554',
            },
            // Sémantique
            'ne-success': {
              50: '#f0fdf4', 100: '#dcfce7', 500: '#22c55e', 600: '#16a34a', 700: '#15803d'
            },
            'ne-warning': {
              50: '#fffbeb', 100: '#fef3c7', 500: '#f59e0b', 600: '#d97706'
            },
            'ne-error': {
              50: '#fef2f2', 100: '#fee2e2', 500: '#ef4444', 600: '#dc2626', 700: '#b91c1c'
            }
          },
          fontFamily: {
            'display': ['"Plus Jakarta Sans"', 'Inter', 'system-ui', 'sans-serif'],
            'body': ['Inter', 'system-ui', 'sans-serif'],
          },
          boxShadow: {
            'ne-sm': '0 1px 2px 0 rgba(0, 0, 0, 0.05)',
            'ne-md': '0 4px 6px -1px rgba(0, 0, 0, 0.07), 0 2px 4px -2px rgba(0, 0, 0, 0.05)',
            'ne-lg': '0 10px 15px -3px rgba(0, 0, 0, 0.08), 0 4px 6px -4px rgba(0, 0, 0, 0.05)',
            'ne-xl': '0 20px 25px -5px rgba(0, 0, 0, 0.08), 0 8px 10px -6px rgba(0, 0, 0, 0.04)',
            'ne-blue': '0 10px 30px -5px rgba(37, 99, 235, 0.25)',
          }
        }
      }
    }
  </script>

  <!-- Design System NetExpress -->
  <link rel="stylesheet" href="{% static 'css/netexpress-design-system.css' %}">
  
  {% block extra_css %}{% endblock %}

  <!-- HTMX pour interactivité -->
  <script src="https://unpkg.com/htmx.org@1.9.10" defer></script>
  
  <!-- Alpine.js pour interactions légères -->
  <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>

  {% block extra_head %}{% endblock %}
</head>
<body class="h-full bg-slate-50 font-body" 
      x-data="{ 
        sidebarOpen: false, 
        userMenuOpen: false, 
        notificationsOpen: false 
      }">
  
  <!-- ============================================
       HEADER — Barre de Navigation Bleue
       ============================================ -->
  <header class="fixed top-0 left-0 right-0 z-50 bg-gradient-to-r from-ne-blue-600 via-ne-blue-700 to-ne-blue-800 shadow-ne-lg">
    <div class="flex items-center justify-between h-16 px-4 lg:px-6">
      
      <!-- Logo & Marque -->
      <div class="flex items-center space-x-4">
        <!-- Bouton menu mobile -->
        <button @click="sidebarOpen = !sidebarOpen" 
                class="lg:hidden p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
          <i class="fas fa-bars text-xl"></i>
        </button>
        
        <a href="{% url 'core:home' %}" class="flex items-center space-x-3 text-white">
          <img src="{% static 'img/logo.svg' %}" alt="NetExpress" class="h-9 w-9">
          <span class="font-display text-xl font-bold tracking-tight hidden sm:inline">
            NetExpress
          </span>
        </a>
      </div>

      <!-- Navigation Desktop (centre) -->
      <nav class="hidden lg:flex items-center space-x-1">
        {% block header_nav %}
        {% if user.is_authenticated %}
          {% if user.is_staff %}
            <a href="{% url 'core:admin_dashboard' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-chart-line mr-2"></i>Dashboard
            </a>
            <a href="{% url 'core:admin_quotes_list' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-file-alt mr-2"></i>Devis
            </a>
            <a href="{% url 'core:admin_invoices_list' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-receipt mr-2"></i>Factures
            </a>
            <a href="{% url 'core:admin_global_planning' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-calendar-alt mr-2"></i>Planning
            </a>
          {% elif user.profile.role == 'worker' %}
            <a href="{% url 'worker:worker_dashboard' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-tasks mr-2"></i>Mes Tâches
            </a>
            <a href="{% url 'tasks:calendar' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-calendar mr-2"></i>Planning
            </a>
          {% else %}
            <a href="{% url 'core:client_portal_dashboard' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-home mr-2"></i>Dashboard
            </a>
            <a href="{% url 'core:client_quotes' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-file-alt mr-2"></i>Mes Devis
            </a>
            <a href="{% url 'core:client_invoices' %}" 
               class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-receipt mr-2"></i>Mes Factures
            </a>
          {% endif %}
        {% else %}
          <a href="{% url 'core:home' %}" 
             class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
            Accueil
          </a>
          <a href="{% url 'services:list' %}" 
             class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
            Services
          </a>
          <a href="{% url 'contact:contact' %}" 
             class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
            Contact
          </a>
        {% endif %}
        {% endblock %}
      </nav>

      <!-- Actions utilisateur (droite) -->
      <div class="flex items-center space-x-2">
        {% if user.is_authenticated %}
          <!-- Bouton Notifications -->
          <div class="relative">
            <button @click="notificationsOpen = !notificationsOpen" 
                    class="relative p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
              <i class="fas fa-bell text-lg"></i>
              <span class="absolute -top-0.5 -right-0.5 flex h-4 w-4 items-center justify-center rounded-full bg-ne-error-500 text-[10px] font-bold text-white">
                0
              </span>
            </button>
            
            <!-- Dropdown Notifications -->
            <div x-show="notificationsOpen" 
                 @click.away="notificationsOpen = false"
                 x-transition:enter="transition ease-out duration-150"
                 x-transition:enter-start="opacity-0 translate-y-2"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-100"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 translate-y-2"
                 class="absolute right-0 mt-2 w-80 bg-white rounded-xl shadow-ne-xl border border-gray-100 overflow-hidden z-50">
              <div class="px-4 py-3 bg-gray-50 border-b border-gray-100">
                <h3 class="font-semibold text-gray-900">Notifications</h3>
              </div>
              <div class="max-h-64 overflow-y-auto">
                <div class="px-4 py-8 text-center text-gray-500">
                  <i class="fas fa-bell-slash text-3xl text-gray-300 mb-2"></i>
                  <p class="text-sm">Aucune notification</p>
                </div>
              </div>
            </div>
          </div>

          <!-- Bouton Messages -->
          <a href="{% url 'messaging:thread_list' %}" 
             class="p-2 text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
            <i class="fas fa-envelope text-lg"></i>
          </a>

          <!-- Menu Utilisateur -->
          <div class="relative">
            <button @click="userMenuOpen = !userMenuOpen" 
                    class="flex items-center space-x-2 px-3 py-1.5 text-white hover:bg-white/10 rounded-lg transition-colors">
              <div class="w-8 h-8 bg-white/20 rounded-full flex items-center justify-center text-sm font-bold">
                {{ user.first_name|first|default:user.username|first|upper }}
              </div>
              <span class="hidden sm:inline text-sm font-medium">
                {{ user.get_short_name|default:user.username }}
              </span>
              <i class="fas fa-chevron-down text-xs text-white/70"></i>
            </button>
            
            <!-- Dropdown Menu Utilisateur -->
            <div x-show="userMenuOpen" 
                 @click.away="userMenuOpen = false"
                 x-transition:enter="transition ease-out duration-150"
                 x-transition:enter-start="opacity-0 translate-y-2"
                 x-transition:enter-end="opacity-100 translate-y-0"
                 x-transition:leave="transition ease-in duration-100"
                 x-transition:leave-start="opacity-100 translate-y-0"
                 x-transition:leave-end="opacity-0 translate-y-2"
                 class="absolute right-0 mt-2 w-56 bg-white rounded-xl shadow-ne-xl border border-gray-100 overflow-hidden z-50">
              
              <div class="px-4 py-3 bg-gray-50 border-b border-gray-100">
                <p class="font-semibold text-gray-900">{{ user.get_full_name|default:user.username }}</p>
                <p class="text-sm text-gray-500">{{ user.email }}</p>
              </div>
              
              <div class="py-2">
                <a href="{% url 'accounts:profile' %}" 
                   class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                  <i class="fas fa-user-circle w-5 text-gray-400"></i>
                  <span class="ml-3">Mon Profil</span>
                </a>
                {% if user.is_staff %}
                <a href="/gestion/" 
                   class="flex items-center px-4 py-2 text-sm text-gray-700 hover:bg-gray-50">
                  <i class="fas fa-cogs w-5 text-gray-400"></i>
                  <span class="ml-3">Administration</span>
                </a>
                {% endif %}
              </div>
              
              <div class="border-t border-gray-100 py-2">
                <a href="{% url 'logout' %}" 
                   class="flex items-center px-4 py-2 text-sm text-ne-error-600 hover:bg-ne-error-50">
                  <i class="fas fa-sign-out-alt w-5"></i>
                  <span class="ml-3">Déconnexion</span>
                </a>
              </div>
            </div>
          </div>
        {% else %}
          <a href="{% url 'login' %}" 
             class="px-4 py-2 text-sm font-medium text-white/90 hover:text-white hover:bg-white/10 rounded-lg transition-colors">
            Connexion
          </a>
          <a href="{% url 'accounts:signup' %}" 
             class="px-4 py-2 text-sm font-semibold bg-white text-ne-blue-600 hover:bg-blue-50 rounded-lg transition-colors shadow-sm">
            Créer un compte
          </a>
        {% endif %}
      </div>
    </div>
  </header>

  <!-- ============================================
       SIDEBAR (Optionnel — pour les portails)
       ============================================ -->
  {% block sidebar %}{% endblock %}

  <!-- Overlay mobile pour sidebar -->
  <div x-show="sidebarOpen" 
       @click="sidebarOpen = false"
       x-transition:enter="transition-opacity ease-linear duration-300"
       x-transition:enter-start="opacity-0"
       x-transition:enter-end="opacity-100"
       x-transition:leave="transition-opacity ease-linear duration-300"
       x-transition:leave-start="opacity-100"
       x-transition:leave-end="opacity-0"
       class="fixed inset-0 z-40 bg-gray-900/50 lg:hidden"></div>

  <!-- ============================================
       MESSAGES (Notifications flash Django)
       ============================================ -->
  {% if messages %}
  <div class="fixed top-20 right-4 z-50 space-y-2 max-w-md">
    {% for message in messages %}
    <div x-data="{ show: true }" 
         x-show="show"
         x-init="setTimeout(() => show = false, 5000)"
         x-transition:enter="transition ease-out duration-300"
         x-transition:enter-start="opacity-0 translate-x-8"
         x-transition:enter-end="opacity-100 translate-x-0"
         x-transition:leave="transition ease-in duration-200"
         x-transition:leave-start="opacity-100 translate-x-0"
         x-transition:leave-end="opacity-0 translate-x-8"
         class="flex items-start p-4 rounded-xl shadow-ne-lg border
                {% if message.tags == 'success' %}bg-ne-success-50 border-ne-success-200 text-ne-success-800
                {% elif message.tags == 'error' %}bg-ne-error-50 border-ne-error-200 text-ne-error-800
                {% elif message.tags == 'warning' %}bg-ne-warning-50 border-ne-warning-200 text-ne-warning-800
                {% else %}bg-ne-blue-50 border-ne-blue-200 text-ne-blue-800{% endif %}">
      <i class="flex-shrink-0 mt-0.5 mr-3
                {% if message.tags == 'success' %}fas fa-check-circle text-ne-success-500
                {% elif message.tags == 'error' %}fas fa-exclamation-circle text-ne-error-500
                {% elif message.tags == 'warning' %}fas fa-exclamation-triangle text-ne-warning-500
                {% else %}fas fa-info-circle text-ne-blue-500{% endif %}"></i>
      <p class="flex-1 text-sm font-medium">{{ message }}</p>
      <button @click="show = false" class="ml-4 text-current opacity-50 hover:opacity-100">
        <i class="fas fa-times"></i>
      </button>
    </div>
    {% endfor %}
  </div>
  {% endif %}

  <!-- ============================================
       CONTENU PRINCIPAL
       ============================================ -->
  <main class="{% block main_class %}pt-16 min-h-screen{% endblock %}">
    {% block content %}{% endblock %}
  </main>

  <!-- ============================================
       FOOTER
       ============================================ -->
  {% block footer %}
  <footer class="bg-ne-blue-950 text-white mt-auto">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
        <!-- Marque -->
        <div>
          <div class="flex items-center space-x-3 mb-4">
            <img src="{% static 'img/logo.svg' %}" alt="NetExpress" class="h-10 w-10">
            <span class="font-display text-2xl font-bold">NetExpress</span>
          </div>
          <p class="text-blue-200 text-sm leading-relaxed">
            Votre partenaire local pour l'entretien de la maison et du bureau en Guyane.
          </p>
        </div>
        
        <!-- Contact -->
        <div>
          <h3 class="font-display font-semibold text-lg mb-4">Contact</h3>
          <div class="space-y-3 text-blue-200 text-sm">
            <p class="flex items-center">
              <i class="fas fa-phone w-5 text-ne-blue-400"></i>
              <span class="ml-3">05 94 30 23 68</span>
            </p>
            <p class="flex items-center">
              <i class="fas fa-mobile-alt w-5 text-ne-blue-400"></i>
              <span class="ml-3">06 94 46 20 12</span>
            </p>
            <p class="flex items-center">
              <i class="fas fa-envelope w-5 text-ne-blue-400"></i>
              <span class="ml-3">contact@nettoyageexpresse.fr</span>
            </p>
            <p class="flex items-start">
              <i class="fas fa-map-marker-alt w-5 text-ne-blue-400 mt-0.5"></i>
              <span class="ml-3">753, Chemin de la Désirée<br>97351 Matoury</span>
            </p>
          </div>
        </div>
        
        <!-- Liens rapides -->
        <div>
          <h3 class="font-display font-semibold text-lg mb-4">Services</h3>
          <ul class="space-y-2 text-blue-200 text-sm">
            <li><a href="{% url 'services:list' %}" class="hover:text-white transition-colors">• Nettoyage professionnel</a></li>
            <li><a href="{% url 'services:list' %}" class="hover:text-white transition-colors">• Entretien espaces verts</a></li>
            <li><a href="{% url 'services:list' %}" class="hover:text-white transition-colors">• Peinture et bricolage</a></li>
            <li><a href="{% url 'devis:request_quote' %}" class="hover:text-white transition-colors">• Demander un devis</a></li>
          </ul>
        </div>
      </div>
      
      <div class="border-t border-blue-800 mt-10 pt-8 text-center text-blue-300 text-sm">
        <p>© {% now "Y" %} NetExpress — Tous droits réservés.</p>
      </div>
    </div>
  </footer>
  {% endblock %}

  <!-- Indicateur de chargement HTMX -->
  <div id="htmx-indicator" 
       class="htmx-indicator fixed top-20 left-1/2 transform -translate-x-1/2 z-50">
    <div class="bg-ne-blue-600 text-white px-5 py-2.5 rounded-full shadow-ne-xl flex items-center space-x-3">
      <div class="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div>
      <span class="text-sm font-medium">Chargement...</span>
    </div>
  </div>

  <!-- Scripts -->
  <script>
    // Configuration HTMX
    document.addEventListener('DOMContentLoaded', function() {
      if (typeof htmx !== 'undefined') {
        htmx.config.globalViewTransitions = true;
        htmx.config.useTemplateFragments = true;
      }
    });
  </script>

  {% block extra_js %}{% endblock %}
</body>
</html>

