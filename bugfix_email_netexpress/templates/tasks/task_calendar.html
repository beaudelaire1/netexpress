{% extends "base.html" %}
{% load static %}

{% block title %}Calendrier des tâches — NetExpress{% endblock %}

{% block extra_head %}
<link rel="stylesheet" href="{% static 'css/backoffice.css' %}">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.css">
{% endblock %}

{% block content %}
<div class="bo-shell">
  <aside class="bo-sidebar" aria-label="Navigation tâches">
    <div class="bo-brand">Nettoyage Express</div>
    <nav class="bo-nav">
      <a class="is-primary" href="{% url 'tasks:calendar' %}">Calendrier</a>
      <a href="{% url 'tasks:list' %}">Liste des tâches</a>
      <a href="{% url 'core:dashboard' %}">Retour dashboard</a>
    </nav>
  </aside>

  <main class="bo-main">
    <div class="bo-head">
      <div>
        <div class="bo-title">Calendrier des tâches</div>
        <div class="bo-subtitle">Vue mensuelle (FullCalendar) — couleurs selon la proximité de l'échéance.</div>
      </div>
    </div>

    <section class="bo-card" style="grid-column: 1 / -1;">
      <div id="tasks-calendar"></div>
      <div class="bo-legend">
        <span><i class="bo-dot" style="background:#dc2626"></i>En retard</span>
        <span><i class="bo-dot" style="background:#f59e0b"></i>Presque en retard</span>
        <span><i class="bo-dot" style="background:#facc15"></i>Proche</span>
        <span><i class="bo-dot" style="background:#2d8a5e"></i>Dans le timing</span>
        <span><i class="bo-dot" style="background:#2563eb"></i>Terminé</span>
      </div>
    </section>
  </main>
</div>
{% endblock %}

{% block scripts %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.15/index.global.min.js"></script>
<script>
  (function() {
    const el = document.getElementById('tasks-calendar');
    if (!el || !window.FullCalendar) return;
    const calendar = new FullCalendar.Calendar(el, {
      initialView: 'dayGridMonth',
      locale: 'fr',
      height: 'auto',
      headerToolbar: {
        left: 'prev,next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,listWeek'
      },
      events: '{% url "tasks:events" %}',
      eventClick: function(info) {
        if (info.event.url) {
          info.jsEvent.preventDefault();
          window.location.href = info.event.url;
        }
      }
    });
    calendar.render();
  })();
</script>
{% endblock %}
